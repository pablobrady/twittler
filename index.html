<!DOCTYPE html>
<html>
  <head>
    <link href="css/twittler.css" rel="stylesheet" media="screen, projection">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
  <header class="mainHeader">
    <hgroup>
      <h1>
        <span class="fa-stack fa-lg">
          <i class="fa fa-square-o fa-stack-2x"></i>
          <i class="fa fa-twitter fa-stack-1x"></i>
        </span>
        <span><a class="navLink" onclick="showHomeView()">Twittler</a></span>
          <span class='headerNav'><i class="fa fa-home"></i> <a id="homeButton" class="navLink">Home/Refresh</a>&nbsp;&nbsp;
      </h1>
    </hgroup>
  </header>
  <section class="contentBodyWrapper group">
    <section class="userColumn group">

      <article class="profileMini bigRoundedBorders">
        <header style="background: url(images/profileMiniBg_pbrady.png) top no-repeat;">
          <img id="profileMini_imgId" src=images/profileMini_pbrady.png class="profileMini_img"><!-- alt http://placehold.it/68x68/dd00dd -->
          <span class="profileTextBlk group">
            <h3>Paul Brady</h3>
            <div class="textSm">@curiousitude</div>
          </span>
        </header>
      </article>

      <article class="trends bigRoundedBorders group">
        <h3>Trends</h3>
        <nav>
          <ul>
            <li><a title="Sorry, not implemmented yet.">A Trending Item of Interest #1</a></li>
            <li><a title="Sorry, not implemmented yet.">A Trending Item of Interest #2</a></li>
            <li><a title="Sorry, not implemmented yet.">A Trending Item of Interest #3</a></li>
            <li><a title="Sorry, not implemmented yet.">A Trending Item of Interest #4</a></li>
            <li><a title="Sorry, not implemmented yet.">A Trending Item of Interest #5</a></li>
            <li><a title="Sorry, not implemmented yet.">A Trending Item of Interest #6</a></li>
          </ul>
        </nav>
      </article>
    </section>

    <section class="tweetColumn bigRoundedBorders group">
      <!-- div class="filterHeader group">
        <h3 id="filterHeaderMsgId" style="display:block;">Filtered results:</h3>
      </div -->

      <div>
        <div id="tweetContent"></div>
      </div>

    </section>
  </section>


      <script>

        var getTweetBlock = function( userName, tweetText, tweetTime) {
          var tweetHTMLBlock = '<img src=http://placehold.it/40x40/FFB5A5 class=profileTweet_img>' +
                                 '<span class="tweetTextBlk tweetTxt group">' + 
                                   '<span class="tweetUser"><a onclick="showUserFilteredTweets(\'' + userName + '\');">@' + userName + '</a></span>&nbsp;&#183&nbsp;<span class="lightTxt tweetDate">' + tweetTime + '</span><br>' + 
                                   tweetText + '<br><br></span>';

          return tweetHTMLBlock;
        }

        var enableHashtagLinks = function(raw) {
          var retVal = "";
          if (raw.indexOf("#")==-1) {
            retVal=raw;
          } else {
            // retVal = raw.replace(/(^|\W)(#[a-z\d][\w-]*)/ig, '$1<a href=index.html?q=no-hash-searches-yet>#$2</a>').replace("#", "");
            retVal = raw.replace(/(^|\W)(#[a-z\d][\w-]*)/ig, '$1<u>$2</u>');
          }
          return retVal;
        };

        var getFormattedDate = function( d ) {
          return d.toLocaleTimeString() + " - " + d.toLocaleDateString();
        };

        var showUserFilteredTweets = function( aUser ) {
          var $tweetContent = $('#tweetContent');
          $tweetContent.html('');

          var index = streams.home.length - 1;
          while(index >= 0){
            var tweet = streams.home[index];
            if (tweet.user == aUser) {
              var $tweet = $('<div class=tweet></div>');
              $tweet.html( getTweetBlock(tweet.user, enableHashtagLinks(tweet.message), getFormattedDate(tweet.created_at) ) );
              $tweet.appendTo($tweetContent);
            }
            index -= 1;
          }
        };

        var showCurrentTweets = function() {
          $("#filterHeaderMsgId").text("");

          var $tweetContent = $('#tweetContent');
          $tweetContent.html('');

          var index = streams.home.length - 1;
          while(index >= 0){
            var tweet = streams.home[index];
            var $tweet = $('<div class=tweet></div>');
            $tweet.html( getTweetBlock(tweet.user, enableHashtagLinks(tweet.message), getFormattedDate(tweet.created_at) ) );
            $tweet.appendTo($tweetContent);
            index -= 1;
          }
        };

        $(document).ready(function(){

          $("#homeButton").on("click", function() {
            showCurrentTweets();
          });

          $("#refreshButton").on("click", function() {
            showCurrentTweets();
          });

          showCurrentTweets();

        });

    </script>
  </body>
</html>
